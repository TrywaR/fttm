function content_download(t,e,a){return site_url=t.site_url?t.site_url:"",void 0===a&&(a=!0),void 0===e&&(e="html"),$.ajax({url:site_url,dataType:e,data:$.extend(t,oParam.ajax_salt),method:"POST",xhr:function(){var t=new window.XMLHttpRequest;return t.upload.addEventListener("progress",function(t){if(t.lengthComputable){fttm_progress_bar(t.loaded/t.total)}},!1),t}}).fail(function(t){a&&fttm_alerts({error:{text:"Ошибка соединения"}})}).done(function(t){a&&fttm_alerts(t)})}function fttm_alerts(t,e){var a=$(document).find(".fttm_alerts");return e&&e.length&&(a=e.find("._fttm_alerts")),t.success&&t.success.text?a.html(fttm_alerts_html(t.success.text,"alert-success")):t.error&&t.error.text?a.html(fttm_alerts_html(t.error.text,"alert-danger")):t.alert&&t.alert.text?a.html(fttm_alerts_html(t.alert.text,"alert-alert")):t.success?a.html(fttm_alerts_html(t.success,"alert-success")):t.error?a.html(fttm_alerts_html(t.error,"alert-danger")):t.alert?a.html(fttm_alerts_html(t.alert,"alert-alert")):void console.log(t)}function fttm_alerts_html(t,e){var a="";return a+='<div class="alert '+(e||"alert-primary")+' alert-dismissible fade show" role="alert">',a+=t,a+='<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',a+="</div>"}function fttm_progress_bar(t){var e=$(document).find(".fttm_progress");t<1?e.addClass("_active_"):e.removeClass("_active_"),e.attr("aria-valuenow",100*t),e.css("width",100*t+"%")}function content_loader(t,e,a,n,o,r,i){var s=t.attr("data-content_loader_action"),l=t.attr("data-content_loader_form"),d=a||t.attr("data-content_loader_to"),n=n?parseInt(n):parseInt(t.attr("data-content_loader_from")),o=o?parseInt(o):parseInt(t.attr("data-content_loader_limit")),r=r||$(document).find(t.data().content_loader_template),i=i||parseInt(t.data().content_loader_position);if(e)if(r){var m=$(document).find(d).find('[data-content_loader_item_id="'+e.id+'"]');m.length?(m.after(content_loader_template(r,e)),m.remove(),t.find("[name=id]").val(""),t.find("[type=submit]").html('<i class="fas fa-plus-square"></i> Добавить'),t.removeClassWild("animate_*"),setTimeout(function(){t.addClass("animate__animated animate__rubberBand")},100)):setTimeout(function(){i?$(document).find(d).append(content_loader_template(r,e)):$(document).find(d).prepend(content_loader_template(r,e))},100)}else fttm_alerts({alert:"Шаблон не найден"});else{e={action:s,form:l,from:n,limit:o};$.when(content_download(e,"json",!1)).then(function(e){e.length?(r?$.each(e,function(t,e){var a=$(this)[0];setTimeout(function(){i?$(document).find(d).append(content_loader_template(r,a)):$(document).find(d).prepend(content_loader_template(r,a))},100*t)}):fttm_alerts({alert:"Шаблон не найден"}),o>e.length?t.remove():t.attr("data-content_loader_from",n+o)):t.remove()})}}function content_loader_template(t,e){var a=[],n=[],o=$(t)[0].innerHTML;for(var r in e)a.push(r),n.push(e[r]);for(var i=0;i<a.length;i++)o=o.split("{{"+a[i]+"}}").join(n[i]);return o}oParam={},oParam.ajax_salt={app:"app"},oParam.site_url="/",$(function(){if($(document).on("click",".form_reset",function(){var t=$(this).parents("form");t[0].reset(),t.find("[name=id]").val(""),t.find("[type=submit]").html('<i class="fas fa-plus-square"></i> Добавить'),$(document).find("#content_loader_to .list-group-item").removeClass("_edit_"),t.removeClassWild("animate_*"),setTimeout(function(){t.addClass("animate__animated animate__rubberBand")},100)}),$(document).on("click",".content_download",function(){var t=$(this),e=t.data().animate_class?t.data().animate_class:"animate__zoomOut",a={action:$(this).data().action,form:$(this).data().form,id:$(this).data().id};if("del"==t.data().form){if(!confirm("Подтвердите удаление"))return!1;if(!t.data().elem)return fttm_alerts({error:"Нет класса для удаления :( аттрибут data-elem"});t.parents(t.data().elem).removeClassWild("animate_*").addClass("animate__animated "+e),setTimeout(function(){t.parents(t.data().elem).remove()},500)}if("edit"==t.data().form)return a.form="show",t.parents(t.data().elem).addClass("_edit_").siblings().removeClass("_edit_"),$.when(content_download(a,"json")).then(function(t){fttm_alerts(t),oEditForm=$(document).find('[data-content_download_edit_type="'+t.type+'"]');for(var a in t){var n=oEditForm.find('[name="'+a+'"]');n.hasClass("select")&&n.find('[value="'+t[a]+'"]').prop("selected",!0),n.val(t[a])}oEditForm.find("[type=submit]").html('<i class="fas fa-pen-square"></i> Сохранить'),oEditForm.removeClassWild("animate_*"),setTimeout(function(){oEditForm.addClass("animate__animated "+e)},100),oCollapse=oEditForm.parents(".accordion"),oCollapse.find(".accordion-button").hasClass("collapsed")&&oCollapse.find(".accordion-button").click()}),!1;$.when(content_download(a,"json")).then(function(t){fttm_alerts(t)})}),$(document).on("click",".content_loader",function(){content_loader($(this))}),$(document).on("click",".content_manager_switch",function(){var t=$(document).find(".content_manager_buttons");return $(this).toggleClass("_active_"),$(this).parents(".list-group-item").toggleClass("content_manager_select"),$(document).find("#content_loader_to .content_manager_select").length?t.hasClass("_hide_")&&(t.removeClassWild("animate_*").addClass("animate__animated animate__backInRight"),setTimeout(function(){t.removeClass("_hide_")},500)):(t.removeClassWild("animate_*").addClass("animate__animated animate__backOutRight"),setTimeout(function(){t.addClass("_hide_")},500)),!1}),$(document).on("click",".content_manager_buttons .del",function(){if(confirm("Вы действительно хотите удалить всё выбранное к херам?")){var t=$(this).parents(".content_manager_buttons"),e=t.data().content_manager_block,a=t.data().content_manager_action,n=t.data().content_manager_item,o=t.data().animate_class?t.data().animate_class:"animate__zoomOut",r={action:a,form:"del"};$(document).find(e+" "+n+".content_manager_select").each(function(){var e=$(this);r.id=e.data().content_manager_item_id,$.when(content_download(r,"json")).then(function(a){e.removeClassWild("animate_*").addClass("animate__animated "+o),setTimeout(function(){e.remove(),t.removeClassWild("animate_*").addClass("animate__animated animate__backOutRight"),setTimeout(function(){t.addClass("_hide_")},500)},500)})})}}),$(document).find("#list-example").length)new bootstrap.ScrollSpy(document.body,{target:"#list-example"});$(document).find("form").on("submit",function(){var t=$(this);return oData=t.serializeArray(),$.when(content_download(oData,"json",!1)).then(function(e){fttm_alerts(e,t),e.model&&localStorage.setItem(e.model,JSON.stringify(e.data)),t.hasClass("content_loader_form")&&content_loader(t,e)}),!1})}),$.fn.removeClassWild=function(t){return this.removeClass(function(e,a){var n=t.replace(/\*/g,"\\S+");return(a.match(new RegExp("\\b"+n,"g"))||[]).join(" ")})};