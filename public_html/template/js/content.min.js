function content_download(t,a,e){return void 0===e&&(e=!0),void 0===a&&(a="html"),$.ajax({url:t.site_url?t.site_url:"",dataType:a,data:$.extend(t,oParam.ajax_salt),method:"POST",xhr:function(){var t=new window.XMLHttpRequest;return t.upload.addEventListener("progress",function(t){if(t.lengthComputable){var a=t.loaded/t.total;fttm_progress_bar(a)}},!1),t}}).fail(function(t){e&&fttm_alerts({error:{text:"Ошибка соединения"}})}).done(function(t){e&&fttm_alerts(t)})}function content_loader_init(){}function content_loader(t,a,e){void 0===a&&(a={}),void 0===e&&(e={}),a.action=t.attr("data-content_loader_action")?t.attr("data-content_loader_action"):a.action,a.form=t.attr("data-content_loader_form")?t.attr("data-content_loader_form"):a.table,a.to=t.attr("data-content_loader_to")?t.attr("data-content_loader_to"):a.to,a.from=t.attr("data-content_loader_from")?t.attr("data-content_loader_from"):a.from,a.limit=t.attr("data-content_loader_limit")?t.attr("data-content_loader_limit"):a.limit,a.template=t.attr("data-content_loader_template")?t.attr("data-content_loader_template"):a.template,a.position=t.attr("data-content_loader_position")?t.attr("data-content_loader_position"):a.position;var n=a.action,o=a.form,i=a.to,d=a.from,r=a.limit,s=$(document).find(a.template),l=a.position;if(e.id)if(s){var m=$(document).find(i).find('[data-content_loader_item_id="'+e.id+'"]');m.length?(m.after(content_loader_template(s,e)),m.remove(),oButton.find("[name=id]").val(""),oButton.find("[type=submit]").html('<i class="fas fa-plus-square"></i> Добавить'),oButton.removeClassWild("animate_*"),setTimeout(function(){oButton.addClass("animate__animated animate__rubberBand")},100)):setTimeout(function(){l?$(document).find(i).append(content_loader_template(s,e)):$(document).find(i).prepend(content_loader_template(s,e))},100)}else fttm_alerts({alert:"Шаблон не найден"});else{e={action:n,form:o,from:d,limit:r};$.when(content_download(e,"json",!1)).then(function(t){t.length?(s?$.each(t,function(t,a){var e=$(this)[0];setTimeout(function(){l?$(document).find(i).append(content_loader_template(s,e)):$(document).find(i).prepend(content_loader_template(s,e))},100*t)}):fttm_alerts({alert:"Шаблон не найден"}),r>t.length?oButton.remove():oButton.attr("data-content_loader_from",d+r)):oButton.remove()})}}function content_loader_template(t,a){var e=[],n=[],o=$(t)[0].innerHTML;for(var i in a)e.push(i),n.push(a[i]);for(var d=0;d<e.length;d++)o=o.split("{{"+e[d]+"}}").join(n[d]);return o}$(function(){$(document).find("form").on("submit",function(){var t=$(this);return oData=t.serializeArray(),$.when(content_download(oData,"json",!0)).done(function(a){if(!a.success)return!1;a.success.model&&localStorage.setItem(a.success.model,JSON.stringify(a.success.data)),a.success.location&&setTimeout(function(){window.location.replace(a.success.location)},500),t.hasClass("reload_page")&&location.reload(),t.hasClass("content_loader_form")&&content_loader(t,{},a.success.elems)}),!1}),$(document).on("click",".form_reset",function(){var t=$(this).parents("form");t[0].reset(),t.find("[name=id]").val(""),t.find("[type=submit]").html('<i class="fas fa-plus-square"></i> Добавить'),$(document).find("#content_loader_to .list-group-item").removeClass("_edit_"),t.removeClassWild("animate_*"),setTimeout(function(){t.addClass("animate__animated animate__rubberBand")},100)}),$(document).on("click",".content_download",function(){var t=$(this),a=t.data().animate_class?t.data().animate_class:"animate__zoomOut",e={action:$(this).data().action,form:$(this).data().form,id:$(this).data().id};if("del"==t.data().form){if(!confirm("Подтвердите удаление"))return!1;if(!t.data().elem)return fttm_alerts({error:"Нет класса для удаления :( аттрибут data-elem"});t.parents(t.data().elem).removeClassWild("animate_*").addClass("animate__animated "+a),setTimeout(function(){t.parents(t.data().elem).remove()},500)}if("edit"==t.data().form)return e.form="show",t.parents(t.data().elem).addClass("_edit_").siblings().removeClass("_edit_"),$.when(content_download(e,"json")).then(function(t){oEditForm=$(document).find('[data-content_download_edit_type="'+t.type+'"]');for(var e in t){var n=oEditForm.find('[name="'+e+'"]');n.hasClass("select")&&n.find('[value="'+t[e]+'"]').prop("selected",!0),n.val(t[e])}oEditForm.find("[type=submit]").html('<i class="fas fa-pen-square"></i> Сохранить'),oEditForm.removeClassWild("animate_*"),setTimeout(function(){oEditForm.addClass("animate__animated "+a)},100),oCollapse=oEditForm.parents(".accordion"),oCollapse.find(".accordion-button").hasClass("collapsed")&&oCollapse.find(".accordion-button").click()}),!1;$.when(content_download(e,"json")).then(function(t){})}),$(document).on("click",".content_loader",function(){content_loader($(this))}),$(document).on("click",".content_manager_switch",function(){var t=$(document).find(".content_manager_buttons");return $(this).toggleClass("_active_"),$(this).parents(".list-group-item").toggleClass("content_manager_select"),$(document).find("#content_loader_to .content_manager_select").length?t.hasClass("_hide_")&&(t.removeClassWild("animate_*").addClass("animate__animated animate__backInRight"),setTimeout(function(){t.removeClass("_hide_")},500)):(t.removeClassWild("animate_*").addClass("animate__animated animate__backOutRight"),setTimeout(function(){t.addClass("_hide_")},500)),!1}),$(document).on("click",".content_manager_buttons .del",function(){if(confirm("Вы действительно хотите удалить всё выбранное к херам?")){var t=$(this).parents(".content_manager_buttons"),a=t.data().content_manager_block,e=t.data().content_manager_action,n=t.data().content_manager_item,o=t.data().animate_class?t.data().animate_class:"animate__zoomOut",i={action:e,form:"del"};$(document).find(a+" "+n+".content_manager_select").each(function(){var a=$(this);i.id=a.data().content_manager_item_id,$.when(content_download(i,"json")).then(function(e){a.removeClassWild("animate_*").addClass("animate__animated "+o),setTimeout(function(){a.remove(),t.removeClassWild("animate_*").addClass("animate__animated animate__backOutRight"),setTimeout(function(){t.addClass("_hide_")},500)},500)})})}})});